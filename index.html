<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Architect v7.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: #f8fafc; font-family: 'Segoe UI', 'PingFang TC', 'Microsoft JhengHei', 'Meiryo', sans-serif; }
        /* ÁéªÁíÉÊì¨ÊÖãËàáÂ∞àÊ•≠ÈÇäÊ°Ü */
        .glass-card { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.08); border-radius: 8px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .input-area { background: #1e293b; border: 1px solid #475569; color: #e2e8f0; border-radius: 4px; transition: all 0.2s; font-family: monospace; }
        .input-area:focus { border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2); outline: none; }
        
        /* Ê®ôÁ±§ÊåâÈàïÊ®£Âºè - Êõ¥ÊâÅÂπ≥„ÄÅÂ∞àÊ•≠ */
        .btn-tab { border-bottom: 2px solid transparent; color: #94a3b8; transition: all 0.2s; white-space: nowrap; flex-shrink: 0; font-weight: 600; font-size: 0.75rem; letter-spacing: 0.05em; text-transform: uppercase; }
        .btn-tab:hover { color: #cbd5e1; }
        .btn-tab.active { border-bottom: 2px solid #3b82f6; color: #3b82f6; }
        
        .tag { background-color: #1e293b; border: 1px solid #334155; transition: all 0.15s; cursor: pointer; display: flex; flex-direction: column; justify-content: center; width: 100%; overflow: hidden; border-radius: 4px; }
        .tag:hover { background-color: #334155; border-color: #60a5fa; }
        .tag:active { transform: translateY(1px); }
        
        /* NSFW Ê®ôÁ±§ÁöÑÁâπÊÆäÊ®£Âºè - ‰ΩéË™øÁöÑË≠¶Á§∫Ëâ≤ */
        .tag-nsfw { border-left: 2px solid #be123c; } 
        .tag-nsfw:hover { border-color: #f43f5e; background-color: #281a1e; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .loading-spinner { border: 2px solid rgba(255,255,255,0.1); border-top: 2px solid #3b82f6; border-radius: 50%; width: 14px; height: 14px; animation: spin 0.8s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .mode-active { background-color: #3b82f6; color: white !important; border-color: #3b82f6; }
        .lang-btn { opacity: 0.5; transition: all 0.2s; font-size: 10px; font-weight: 600; letter-spacing: 1px; }
        .lang-btn:hover { opacity: 1; }
        .lang-btn.active { opacity: 1; color: #3b82f6; }
    </style>
</head>
<body class="p-4 md:p-8 bg-slate-950 min-h-screen selection:bg-blue-500/30">

    <div class="max-w-[1500px] mx-auto">
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-6 gap-4 border-b border-slate-800/60 pb-4">
            <div>
                <h1 class="text-xl md:text-2xl font-bold text-white flex items-center gap-3 tracking-tight">
                    <svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                    <span id="ui-title">PROMPT ARCHITECT</span> 
                    <span class="text-[10px] bg-blue-900/30 text-blue-400 border border-blue-800/50 px-1.5 py-0.5 rounded text-xs font-medium">v7.0</span>
                </h1>
                <p id="ui-subtitle" class="text-slate-400 text-xs mt-1 font-mono tracking-wide opacity-80">PROFESSIONAL AI IMAGE SYNTHESIS TOOL</p>
            </div>
            <div class="flex items-center gap-4">
                <div class="bg-slate-900/50 rounded border border-slate-800 p-1 flex">
                    <button onclick="setLang('zh')" class="lang-btn px-3 py-1 text-slate-300">ÁπÅ‰∏≠</button>
                    <button onclick="setLang('en')" class="lang-btn active px-3 py-1 text-slate-300">EN</button>
                    <button onclick="setLang('ja')" class="lang-btn px-3 py-1 text-slate-300">JPN</button>
                </div>
                <button onclick="resetAll()" class="text-slate-500 hover:text-red-400 transition p-2 hover:bg-slate-900 rounded group" title="Reset">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                </button>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <div class="lg:col-span-7 space-y-5">
                <!-- AI Assist Section -->
                <div class="glass-card p-4 border-l-2 border-l-blue-500">
                    <label class="flex justify-between text-[10px] font-bold text-blue-400 mb-2 uppercase tracking-widest">
                        <span>AI Assistant</span>
                        <span class="text-slate-600">GEMINI-FLASH-ENABLED</span>
                    </label>
                    <div class="flex gap-2">
                        <input id="aiInput" type="text" class="flex-1 input-area p-2.5 text-xs md:text-sm" placeholder="e.g., Cyberpunk street with neon rain...">
                        <button onclick="askAI()" class="bg-blue-600 hover:bg-blue-500 text-white px-4 rounded text-xs font-bold transition shadow-lg shadow-blue-900/20 flex items-center gap-2 whitespace-nowrap">
                            <span id="aiBtnText">GENERATE KEYWORDS</span>
                            <div id="aiLoading" class="loading-spinner hidden"></div>
                        </button>
                    </div>
                </div>

                <!-- Tags Library -->
                <div class="glass-card p-4 h-[600px] flex flex-col">
                    <div class="flex border-b border-slate-700/50 overflow-x-auto no-scrollbar mb-4 gap-2 pb-2">
                        <button class="btn-tab active px-3 py-2" id="tab-character" onclick="switchTab('character', this)">CHARACTER</button>
                        <button class="btn-tab px-3 py-2" id="tab-outfit" onclick="switchTab('outfit', this)">OUTFIT</button>
                        <button class="btn-tab px-3 py-2" id="tab-shot" onclick="switchTab('shot', this)">COMPOSITION</button>
                        <button class="btn-tab px-3 py-2" id="tab-style" onclick="switchTab('style', this)">STYLE</button>
                        <button class="btn-tab px-3 py-2" id="tab-env" onclick="switchTab('env', this)">ENVIRONMENT</button>
                        <button class="btn-tab px-3 py-2" id="tab-light" onclick="switchTab('light', this)">LIGHTING</button>
                        <button class="btn-tab px-3 py-2 text-rose-500 hover:text-rose-400" id="tab-secret" onclick="switchTab('secret', this)">üîû NSFW</button>
                    </div>
                    <!-- Tags Grid -->
                    <div id="tagsContainer" class="grid grid-cols-3 gap-2 overflow-y-auto no-scrollbar pr-1 content-start flex-1"></div>
                </div>
            </div>

            <div class="lg:col-span-5 space-y-5">
                <!-- Matrix Control -->
                <div class="glass-card p-5">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-[10px] font-bold tracking-[0.2em] uppercase text-slate-400">Parameter Matrix</h2>
                        <span class="text-[9px] text-slate-600 font-mono">ACTIVE NODES: <span id="node-count">0</span></span>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <div class="space-y-1"><label id="lbl-character" class="text-[9px] font-bold text-slate-500 uppercase">Character</label><textarea id="m-character" oninput="updatePreview()" class="input-area w-full p-2 text-[10px] h-16 leading-tight no-scrollbar resize-none"></textarea></div>
                        <div class="space-y-1"><label id="lbl-outfit" class="text-[9px] font-bold text-slate-500 uppercase">Outfit</label><textarea id="m-outfit" oninput="updatePreview()" class="input-area w-full p-2 text-[10px] h-16 leading-tight no-scrollbar resize-none"></textarea></div>
                        <div class="space-y-1"><label id="lbl-shot" class="text-[9px] font-bold text-slate-500 uppercase">Shot</label><textarea id="m-shot" oninput="updatePreview()" class="input-area w-full p-2 text-[10px] h-16 leading-tight no-scrollbar resize-none"></textarea></div>
                        <div class="space-y-1"><label id="lbl-style" class="text-[9px] font-bold text-slate-500 uppercase">Style</label><textarea id="m-style" oninput="updatePreview()" class="input-area w-full p-2 text-[10px] h-16 leading-tight no-scrollbar resize-none"></textarea></div>
                        <div class="space-y-1"><label id="lbl-env" class="text-[9px] font-bold text-slate-500 uppercase">Environment</label><textarea id="m-env" oninput="updatePreview()" class="input-area w-full p-2 text-[10px] h-16 leading-tight no-scrollbar resize-none"></textarea></div>
                        <div class="space-y-1"><label id="lbl-secret" class="text-[9px] font-bold text-rose-800 uppercase">Restricted</label><textarea id="m-secret" oninput="updatePreview()" class="input-area w-full p-2 text-[10px] h-16 leading-tight no-scrollbar resize-none border-rose-900/30 bg-rose-950/10"></textarea></div>
                    </div>
                    <button id="btn-update" onclick="updatePreview()" class="w-full bg-slate-800 hover:bg-slate-700 text-slate-300 py-2 rounded text-[10px] font-bold tracking-widest uppercase transition border border-slate-700">Refine Preview</button>
                </div>

                <!-- Final Output -->
                <div class="glass-card p-5 border-t-4 border-t-emerald-500 shadow-xl relative flex flex-col h-[280px]">
                    <div class="flex justify-between items-center mb-3">
                        <div class="flex items-center bg-slate-900 p-0.5 rounded border border-slate-800">
                            <button id="mode-llm" onclick="setMode('llm')" class="mode-active px-3 py-1 rounded-[3px] text-[9px] font-bold transition tracking-wider">NATURAL</button>
                            <button id="mode-mj" onclick="setMode('mj')" class="px-3 py-1 rounded-[3px] text-[9px] font-bold transition text-slate-500 tracking-wider">MIDJOURNEY</button>
                        </div>
                        <select id="arSelect" onchange="updatePreview()" class="bg-slate-900 text-slate-400 text-[10px] py-1 px-2 rounded border border-slate-800 outline-none font-mono">
                            <option value="--ar 1:1">1:1 Square</option>
                            <option value="--ar 16:9">16:9 Landscape</option>
                            <option value="--ar 9:16">9:16 Portrait</option>
                            <option value="--ar 2:3" selected>2:3 Classic</option>
                            <option value="--ar 21:9">21:9 Ultrawide</option>
                        </select>
                    </div>
                    <div id="finalPrompt" class="bg-black/50 rounded p-3 font-mono text-emerald-400 text-[11px] flex-1 break-words border border-slate-800/50 leading-relaxed cursor-pointer hover:bg-black/70 overflow-y-auto transition-colors" onclick="copyPrompt()">Waiting for parameters...</div>
                    <button id="btn-copy" onclick="copyPrompt()" class="w-full mt-3 bg-emerald-600 hover:bg-emerald-500 py-2.5 rounded text-white text-[11px] font-bold tracking-widest uppercase transition shadow-lg active:translate-y-0.5">Copy to Clipboard</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const uiText = {
            zh: {
                title: "PROMPT ARCHITECT",
                subtitle: "Â∞àÊ•≠ AI ÂúñÂÉèÁîüÊàêËºîÂä©Â∑•ÂÖ∑",
                placeholder: "Ëº∏ÂÖ•Ê¶ÇÂøµ (‰æãÂ¶Ç: Ë≥ΩÂçöÈæêÂÖãË°óÈÅì„ÄÅÈõ®‰∏≠)...",
                btnAi: "ÁîüÊàêÈóúÈçµË©û",
                tabs: { char: "ËßíËâ≤‰∏ªÈ´î", outfit: "ÊúçÈ£æÈÄ†Âûã", shot: "Èè°È†≠ÊßãÂúñ", style: "ËóùË°ìÈ¢®Ê†º", env: "Áí∞Â¢ÉÊ∞õÂúç", light: "ÂÖâÂΩ±ÈÖçÁΩÆ", secret: "üîû ÈôêÂà∂Á¥ö" },
                matrix: { char: "ËßíËâ≤", outfit: "ÊúçÈ£æ", shot: "ÊßãÂúñ", style: "È¢®Ê†º", env: "Áí∞Â¢É", secret: "ÁâπÊÆä/NSFW" },
                btnUpdate: "Êõ¥Êñ∞È†êË¶Ω",
                btnCopy: "Ë§áË£ΩÂííË™û",
                waiting: "Á≠âÂæÖÂèÉÊï∏Ëº∏ÂÖ•...",
                toastAiSuccess: "ÈóúÈçµË©ûÁîüÊàêÂÆåÁï¢",
                toastAiFail: "AI ÊúçÂãôÊö´ÊôÇÁÑ°Ê≥ï‰ΩøÁî®",
                toastCopy: "ÂííË™ûÂ∑≤Ë§áË£ΩÂà∞Ââ™Ë≤ºÁ∞ø",
                resetConfirm: "Á¢∫ÂÆöË¶ÅÈáçÁΩÆÊâÄÊúâÂèÉÊï∏ÂóéÔºü"
            },
            en: {
                title: "PROMPT ARCHITECT",
                subtitle: "PROFESSIONAL AI IMAGE SYNTHESIS TOOL",
                placeholder: "Enter concept (e.g. Cyberpunk street)...",
                btnAi: "GENERATE KEYWORDS",
                tabs: { char: "CHARACTER", outfit: "OUTFIT", shot: "COMPOSITION", style: "STYLE", env: "ENVIRONMENT", light: "LIGHTING", secret: "üîû NSFW" },
                matrix: { char: "CHARACTER", outfit: "OUTFIT", shot: "SHOT", style: "STYLE", env: "ENV", secret: "RESTRICTED" },
                btnUpdate: "REFINE PREVIEW",
                btnCopy: "COPY TO CLIPBOARD",
                waiting: "Waiting for parameters...",
                toastAiSuccess: "Keywords generated successfully.",
                toastAiFail: "AI service unavailable.",
                toastCopy: "Prompt copied to clipboard.",
                resetConfirm: "Reset all parameters?"
            },
            ja: {
                title: "PROMPT ARCHITECT",
                subtitle: "„Éó„É≠„Éï„Çß„ÉÉ„Ç∑„Éß„Éä„É´AIÁîªÂÉèÁîüÊàê„ÉÑ„Éº„É´",
                placeholder: "„Ç≥„É≥„Çª„Éó„Éà„ÇíÂÖ•Âäõ (‰æã: „Çµ„Ç§„Éê„Éº„Éë„É≥„ÇØ)...",
                btnAi: "„Ç≠„Éº„ÉØ„Éº„ÉâÁîüÊàê",
                tabs: { char: "„Ç≠„É£„É©„ÇØ„Çø„Éº", outfit: "ÊúçË£Ö", shot: "ÊßãÂõ≥", style: "„Çπ„Çø„Ç§„É´", env: "Áí∞Â¢É", light: "ÁÖßÊòé", secret: "üîû ÊåáÂÆöÂà∂Èôê" },
                matrix: { char: "„Ç≠„É£„É©", outfit: "ÊúçË£Ö", shot: "ÊßãÂõ≥", style: "„Çπ„Çø„Ç§„É´", env: "Áí∞Â¢É", secret: "Âà∂Èôê/NSFW" },
                btnUpdate: "„Éó„É¨„Éì„É•„ÉºÊõ¥Êñ∞",
                btnCopy: "„ÇØ„É™„ÉÉ„Éó„Éú„Éº„Éâ„Å´„Ç≥„Éî„Éº",
                waiting: "„Éë„É©„É°„Éº„ÇøÂæÖÊ©ü‰∏≠...",
                toastAiSuccess: "„Ç≠„Éº„ÉØ„Éº„ÉâÁîüÊàêÂÆå‰∫Ü",
                toastAiFail: "AI„Çµ„Éº„Éì„Çπ„Ç®„É©„Éº",
                toastCopy: "„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü",
                resetConfirm: "„Éë„É©„É°„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü"
            }
        };

        const tagLibrary = {
            character: [
                {zh:'Êó•Á≥ªÂ∞ëÂ•≥',ja:'Êó•Êú¨„ÅÆÂ∞ëÂ•≥',en:'Japanese girl'},{zh:'Á≤æÁ∑ªÈù¢ÂÆπ',ja:'Á≤æÂØÜ„Å™È°îÁ´ã„Å°',en:'Detailed face'},{zh:'Ë≤ìËÄ≥Â®ò',ja:'Áå´ËÄ≥Â®ò',en:'Nekomusume'},{zh:'Á≤æÈùàËÄ≥',ja:'„Ç®„É´„ÉïËÄ≥',en:'Elf ears'},{zh:'Áï∞Ëâ≤Áû≥',ja:'„Ç™„ÉÉ„Éâ„Ç¢„Ç§',en:'Heterochromia'},{zh:'Ë≥ΩÂçöÁæ©È´î',ja:'„Çµ„Ç§„Éê„Éº„Éú„Éá„Ç£',en:'Cybernetic'},
                {zh:'ÂÜ∑Ëâ∑Âæ°Âßê',ja:'„ÇØ„Éº„É´„Å™Â§ß‰∫∫„ÅÆÂ•≥ÊÄß',en:'Mature woman'},{zh:'ÂÖÉÊ∞£ËòøËéâ',ja:'ÂÖÉÊ∞ó„Å™„É≠„É™',en:'Energetic lolita'},{zh:'ÈäÄËâ≤Èï∑È´Æ',ja:'ÈäÄÈ´™„ÅÆ„É≠„É≥„Ç∞„Éò„Ç¢',en:'Silver hair'},{zh:'Ê©üÂô®Â∞ëÂ•≥',ja:'„Ç¢„É≥„Éâ„É≠„Ç§„ÉâÂ∞ëÂ•≥',en:'Android girl'},{zh:'ÈõôÈ¶¨Â∞æ',ja:'„ÉÑ„Ç§„É≥„ÉÜ„Éº„É´',en:'Twin tails'},{zh:'Êà∞È¨•‰øÆÂ•≥',ja:'„Éê„Éà„É´„Ç∑„Çπ„Çø„Éº',en:'Battle nun'},
                {zh:'Âì•Âæ∑Â∞ëÂ•≥',ja:'„Ç¥„Ç∑„ÉÉ„ÇØÂ∞ëÂ•≥',en:'Gothic girl'},{zh:'È≠ÖÈ≠î',ja:'„Çµ„Ç≠„É•„Éê„Çπ',en:'Succubus'},{zh:'ÁãêÂ®ò',ja:'ÁãêÂ®ò',en:'Fox girl'},{zh:'ÂíåÊúçÁæé‰∫∫',ja:'ÁùÄÁâ©Áæé‰∫∫',en:'Kimono beauty'},{zh:'Ê£ÆÊûóÂ•≥Â∑´',ja:'Ê£Æ„ÅÆÈ≠îÂ•≥',en:'Forest witch'},{zh:'ÊòüÈöõÊà∞Â£´',ja:'„Çπ„Éö„Éº„Çπ„Éû„É™„Éº„É≥',en:'Space marine'},
                {zh:'Ëä≠ËïæËàûËÄÖ',ja:'„Éê„É¨„É™„Éº„Éä',en:'Ballerina'},{zh:'ÁâπÂ∑•',ja:'„Çπ„Éë„Ç§',en:'Secret agent'},{zh:'Âê∏Ë°ÄÈ¨º',ja:'„É¥„Ç°„É≥„Éë„Ç§„Ç¢',en:'Vampire'},{zh:'Áæé‰∫∫È≠ö',ja:'‰∫∫È≠ö',en:'Mermaid'},{zh:'ÈæçÊóèÂ∞ëÂ•≥',ja:'„Éâ„É©„Ç¥„É≥„ÅÆÂ∞ëÂ•≥',en:'Dragon girl'},{zh:'È´ò‰∏≠Áîü',ja:'Â•≥Â≠êÈ´òÁîü',en:'High school girl'},
                {zh:'Ê≠¶Â£´',ja:'‰æç',en:'Samurai'},{zh:'Â∞èÊÉ°È≠î',ja:'Â∞èÊÇ™È≠î',en:'Little devil'},{zh:'Â§©‰Ωø',ja:'Â§©‰Ωø',en:'Angel'},{zh:'Ëæ¶ÂÖ¨ÂÆ§OL',ja:'„Ç™„Éï„Ç£„Çπ„É¨„Éá„Ç£',en:'Office lady'},{zh:'Â∑´Â•≥',ja:'Â∑´Â•≥',en:'Miko'},{zh:'Êé¢Èö™ÂÆ∂',ja:'ÂÜíÈô∫ÂÆ∂',en:'Explorer'}
            ],
            outfit: [
                {zh:'Ê©üËÉΩÈ¢®',ja:'„ÉÜ„ÉÉ„ÇØ„Ç¶„Çß„Ç¢',en:'Techwear'},{zh:'ÂíåÊúç',ja:'ÁùÄÁâ©',en:'Kimono'},{zh:'Ê©üÁî≤',ja:'„É°„Ç´„Ç¢„Éº„Éû„Éº',en:'Mecha armor'},{zh:'Â•≥ÂÉïË£ù',ja:'„É°„Ç§„ÉâÊúç',en:'Maid outfit'},{zh:'Ê∞¥ÊâãÊúç',ja:'„Çª„Éº„É©„ÉºÊúç',en:'Sailor uniform'},{zh:'Âì•Âæ∑ËòøËéâ',ja:'„Ç¥„Çπ„É≠„É™',en:'Gothic lolita'},
                {zh:'Ë•øË£ù',ja:'„Çπ„Éº„ÉÑ',en:'Suit'},{zh:'Ê≥≥Ë£ù',ja:'Ê∞¥ÁùÄ',en:'Swimsuit'},{zh:'Êà∞Ë°ìËÉåÂøÉ',ja:'„Çø„ÇØ„ÉÜ„Ç£„Ç´„É´„Éô„Çπ„Éà',en:'Tactical vest'},{zh:'Èú≤ËÇ©ÊØõË°£',ja:'„Ç™„Éï„Ç∑„Éß„É´„Çª„Éº„Çø„Éº',en:'Off-shoulder sweater'},{zh:'ÊôöÁ¶ÆÊúç',ja:'„Ç§„Éñ„Éã„É≥„Ç∞„Éâ„É¨„Çπ',en:'Evening gown'},{zh:'ÊóóË¢ç',ja:'„ÉÅ„É£„Ç§„Éä„Éâ„É¨„Çπ',en:'Cheongsam'},
                {zh:'ÁöÆÂ§æÂÖã',ja:'„É¨„Ç∂„Éº„Ç∏„É£„Ç±„ÉÉ„Éà',en:'Leather jacket'},{zh:'Ëä≠ËïæËàûË£ô',ja:'„ÉÅ„É•„ÉÅ„É•',en:'Tutu'},{zh:'‰π≥ËÜ†Ë£ù',ja:'„É©„ÉÜ„ÉÉ„ÇØ„Çπ„Çπ„Éº„ÉÑ',en:'Latex outfit'},{zh:'ÈÅãÂãïÊúç',ja:'„Çπ„Éù„Éº„ÉÑ„Ç¶„Çß„Ç¢',en:'Sportswear'},{zh:'Áµ≤Á∂¢Èï∑Ë£ô',ja:'„Ç∑„É´„ÇØ„Éâ„É¨„Çπ',en:'Silk dress'},{zh:'ÁõîÁî≤',ja:'„Éó„É¨„Éº„Éà„Ç¢„Éº„Éû„Éº',en:'Plate armor'},
                {zh:'ËïæÁµ≤ÂÖßË°£',ja:'„É¨„Éº„Çπ„É©„É≥„Ç∏„Çß„É™„Éº',en:'Lace lingerie'},{zh:'ÊñóÁØ∑',ja:'„Éû„É≥„Éà',en:'Cloak'},{zh:'Ê†°Êúç',ja:'Âà∂Êúç',en:'School uniform'},{zh:'ÈÄ£È´îË°£',ja:'„Éú„Éá„Ç£„Çπ„Éº„ÉÑ',en:'Bodysuit'},{zh:'Áâõ‰ªîË§≤',ja:'„Ç∏„Éº„É≥„Ç∫',en:'Jeans'},{zh:'ÂØ¨È¨ÜTÊÅ§',ja:'„Ç™„Éº„Éê„Éº„Çµ„Ç§„Ç∫T„Ç∑„É£„ÉÑ',en:'Oversized t-shirt'},
                {zh:'ÊØõÁöÆÂ§ßË°£',ja:'ÊØõÁöÆ„ÅÆ„Ç≥„Éº„Éà',en:'Fur coat'},{zh:'ÊùüËÖ∞',ja:'„Ç≥„É´„Çª„ÉÉ„Éà',en:'Corset'},{zh:'ÈÄèË¶ñË£ù',ja:'„Ç∑„Éº„Çπ„É´„Éº',en:'See-through'},{zh:'ÂúçË£ô',ja:'„Ç®„Éó„É≠„É≥',en:'Apron'},{zh:'‰øÆÈÅìÊúç',ja:'‰øÆÈÅìÊúç',en:'Religious robe'},{zh:'Â©öÁ¥ó',ja:'„Ç¶„Çß„Éá„Ç£„É≥„Ç∞„Éâ„É¨„Çπ',en:'Wedding dress'}
            ],
            shot: [
                {zh:'ÂÖ®Ë∫´ÁÖß',ja:'ÂÖ®Ë∫´',en:'Full body'},{zh:'ËáâÈÉ®ÁâπÂØ´',ja:'„Éâ„Ç¢„ÉÉ„Éó',en:'Extreme close-up'},{zh:'ËÉåÂΩ±',ja:'Âæå„ÇçÂßø',en:'Back view'},{zh:'‰øØË¶ñËßí',ja:'‰øØÁû∞',en:'Bird eyes'},{zh:'‰ª∞Ë¶ñËßí',ja:'ÁÖΩ„Çä',en:'Worm eye'},{zh:'ÂãïÊÖãÂßøÂã¢',ja:'Ë∫çÂãïÊÑü„ÅÆ„ÅÇ„Çã„Éù„Éº„Ç∫',en:'Dynamic pose'},
                {zh:'ÂçäË∫´ÂÉè',ja:'‰∏äÂçäË∫´',en:'Upper body'},{zh:'‰∏âÈù¢Âúñ',ja:'‰∏âÈù¢Âõ≥',en:'Character sheet'},{zh:'Â§ßÁâπÂØ´',ja:'„Éû„ÇØ„É≠ÊíÆÂΩ±',en:'Macro shot'},{zh:'Âª£ËßíÈè°È†≠',ja:'Â∫ÉËßí„É¨„É≥„Ç∫',en:'Wide angle'},{zh:'È≠öÁúº',ja:'È≠öÁúº„É¨„É≥„Ç∫',en:'Fisheye'},{zh:'ÊôØÊ∑±',ja:'Ë¢´ÂÜôÁïåÊ∑±Â∫¶',en:'Depth of field'},
                {zh:'ÂùêÂßø',ja:'Â∫ß„Çã',en:'Sitting'},{zh:'Ë∫∫Âßø',ja:'ÂØù„Åù„Åπ„Çã',en:'Lying down'},{zh:'ÂæûÂæåÊñπÁúã',ja:'ËÉåÂæå„Åã„Çâ',en:'Looking from behind'},{zh:'‰ΩéÊ©ü‰Ωç',ja:'„É≠„Éº„Ç¢„É≥„Ç∞„É´',en:'Low angle'},{zh:'ÁâπÂØ´Èè°È†≠',ja:'„ÇØ„É≠„Éº„Ç∫„Ç¢„ÉÉ„Éó',en:'Close-up shot'},{zh:'ÁúºÈÉ®',ja:'ÁõÆÂÖÉ',en:'Eye focus'},
                {zh:'ÊâãÈÉ®',ja:'ÊâãÂÖÉ',en:'Hand focus'},{zh:'ÂÖ©ÂÄã‰∫∫',ja:'„ÉÑ„Éº„Ç∑„Éß„ÉÉ„Éà',en:'Two people'},{zh:'ÈõÜÈ´îÁÖß',ja:'ÈõÜÂêàÂÜôÁúü',en:'Group shot'},{zh:'Ëç∑Ëò≠Ëßí',ja:'„ÉÄ„ÉÉ„ÉÅ„Ç¢„É≥„Ç∞„É´',en:'Dutch angle'},{zh:'ÊÖ¢Âãï‰Ωú',ja:'„Çπ„É≠„Éº„É¢„Éº„Ç∑„Éß„É≥È¢®',en:'Slow motion feel'},{zh:'Á¢éÁâáÊÑü',ja:'Êñ≠ÁâáÁöÑ',en:'Fragmentary'},
                {zh:'Ââ™ÂΩ±',ja:'„Ç∑„É´„Ç®„ÉÉ„Éà',en:'Silhouette'},{zh:'ÂÅ¥Èù¢ÁÖß',ja:'Ê®™È°î',en:'Profile shot'},{zh:'Ê®°Á≥äËÉåÊôØ',ja:'ËÉåÊôØ„Éú„Ç±',en:'Blurred background'},{zh:'ÂãïÊÖãÊ®°Á≥ä',ja:'„É¢„Éº„Ç∑„Éß„É≥„Éñ„É©„Éº',en:'Motion blur'},{zh:'ÂÖ®ÊôØ',ja:'„Éë„Éé„É©„Éû',en:'Panoramic'},{zh:'Â∞çÁ®±',ja:'„Ç∑„É≥„É°„Éà„É™„Éº',en:'Symmetry'}
            ],
            style: [
                {zh:'Êñ∞Êµ∑Ë™†',ja:'Êñ∞Êµ∑Ë™†È¢®',en:'Shinkai style'},{zh:'Ë≥ΩÂçöÈæêÂÖã',ja:'„Çµ„Ç§„Éê„Éº„Éë„É≥„ÇØ',en:'Cyberpunk'},{zh:'ÂêâÂçúÂäõ',ja:'„Ç∏„Éñ„É™È¢®',en:'Ghibli style'},{zh:'ËôõÂπªÂºïÊìé5',ja:'UE5„É¨„É≥„ÉÄ„É™„É≥„Ç∞',en:'UE5 render'},{zh:'ÊµÆ‰∏ñÁπ™',ja:'ÊµÆ‰∏ñÁµµ',en:'Ukiyo-e'},{zh:'ÂØ´ÂØ¶ÊîùÂΩ±',ja:'„Éï„Ç©„Éà„É™„Ç¢„É´',en:'Photorealistic'},
                {zh:'ÁöÆÂÖãÊñØ',ja:'„Éî„ÇØ„Çµ„ÉºÈ¢®',en:'Pixar style'},{zh:'Âæ©Âè§ÂãïÊº´',ja:'„É¨„Éà„É≠„Ç¢„Éã„É°',en:'Retro anime'},{zh:'Ê≤πÁï´',ja:'Ê≤πÁµµ',en:'Oil painting'},{zh:'Ê∞¥ÂΩ©',ja:'Ê∞¥ÂΩ©Áîª',en:'Watercolor'},{zh:'Á∑öÁ®ø',ja:'Á∑öÁîª',en:'Line art'},{zh:'ÈªèÂúüÈ¢®',ja:'Á≤òÂúüÈ¢®',en:'Clay style'},
                {zh:'Ëí∏Ê∞£ÈæêÂÖã',ja:'„Çπ„ÉÅ„Éº„É†„Éë„É≥„ÇØ',en:'Steampunk'},{zh:'Ê•µÁ∞°‰∏ªÁæ©',ja:'„Éü„Éã„Éû„É™„Ç∫„É†',en:'Minimalism'},{zh:'Ë∂ÖÁèæÂØ¶',ja:'„Ç∑„É•„É´„É¨„Ç¢„É™„Çπ„É†',en:'Surrealism'},{zh:'ÂÉèÁ¥†Áï´',ja:'„Éâ„ÉÉ„ÉàÁµµ',en:'Pixel art'},{zh:'Â¢®Áï´',ja:'Ê∞¥Â¢®Áîª',en:'Ink wash'},{zh:'ÈâõÁ≠ÜÁ¥†Êèè',ja:'ÈâõÁ≠ÜÁîª',en:'Pencil sketch'},
                {zh:'‰∏âÁ∂≠Ê∏≤Êüì',ja:'3D„É¨„É≥„ÉÄ„É™„É≥„Ç∞',en:'3D render'},{zh:'ÈõªÂΩ±ÊÑü',ja:'„Ç∑„Éç„Éû„ÉÜ„Ç£„ÉÉ„ÇØ',en:'Cinematic style'},{zh:'Á≤âË†üÁ≠Ü',ja:'„Éë„Çπ„ÉÜ„É´Áîª',en:'Pastel style'},{zh:'Â°óÈ¥â',ja:'„Ç∞„É©„Éï„Ç£„ÉÜ„Ç£',en:'Graffiti'},{zh:'Ë£ùÈ£æËóùË°ì',ja:'„Ç¢„Éº„É´„Éá„Ç≥',en:'Art deco'},{zh:'Â∑¥Ê¥õÂÖã',ja:'„Éê„É≠„ÉÉ„ÇØ',en:'Baroque'},
                {zh:'Ê≥¢ÊôÆËóùË°ì',ja:'„Éù„ÉÉ„Éó„Ç¢„Éº„Éà',en:'Pop art'},{zh:'Ê¶ÇÂøµË®≠Ë®à',ja:'„Ç≥„É≥„Çª„Éó„Éà„Ç¢„Éº„Éà',en:'Concept art'},{zh:'ÊöóÈªëÁ≥ª',ja:'„ÉÄ„Éº„ÇØ',en:'Dark style'},{zh:'Â§¢ÂπªÊÑü',ja:'„Éâ„É™„Éº„Éü„Éº',en:'Dreamy style'},{zh:'Êú™‰æÜÊÑü',ja:'ËøëÊú™Êù•ÁöÑ',en:'Futuristic'},{zh:'Êá∑ËàäÊÑü',ja:'„Éé„Çπ„Çø„É´„Ç∏„ÉÉ„ÇØ',en:'Nostalgic'}
            ],
            env: [
                {zh:'ÈúìËôπÊù±‰∫¨',ja:'„Éç„Ç™„É≥Êù±‰∫¨',en:'Neon Tokyo'},{zh:'Ê´ªËä±Êûó',ja:'Ê°ú‰∏¶Êú®',en:'Cherry garden'},{zh:'Êú´Êó•Âª¢Â¢ü',ja:'ÁµÇÊú´„ÅÆÂªÉÂ¢ü',en:'Post-apoc'},{zh:'Ê∑±Êµ∑ÈÅ∫Ëπü',ja:'Ê∑±Êµ∑ÈÅ∫Ë∑°',en:'Underwater'},{zh:'ÂÆáÂÆôÁ´ô',ja:'ÂÆáÂÆô„Çπ„ÉÜ„Éº„Ç∑„Éß„É≥',en:'Space station'},{zh:'È≠îÊ≥ïÂ≠∏Èô¢',ja:'È≠îÊ≥ïÂ≠¶Âúí',en:'Magic academy'},
                {zh:'ÂúñÊõ∏È§®',ja:'Âõ≥Êõ∏È§®',en:'Library'},{zh:'ÊµÆÁ©∫Â≥∂',ja:'ÊµÆÈÅäÂ≥∂',en:'Floating island'},{zh:'Ëí∏Ê∞£ÈæêÂÖãÂ∏Ç',ja:'„Çπ„ÉÅ„Éº„É†„Éë„É≥„ÇØÈÉΩÂ∏Ç',en:'Steampunk city'},{zh:'Âª¢Ê£ÑÈÜ´Èô¢',ja:'ÂªÉÁóÖÈô¢',en:'Abandoned hospital'},{zh:'ËÅñË™ïÈõ™ÊôØ',ja:'„ÇØ„É™„Çπ„Éû„Çπ„ÅÆÈõ™ÊôØËâ≤',en:'Snowy night'},{zh:'Á•≠ÂÖ∏',ja:'Á•≠„Çä',en:'Festival'},
                {zh:'Èõ®Â§©Ë°óÈÅì',ja:'Èõ®„ÅÆË°óË∑Ø',en:'Rainy street'},{zh:'ÂíñÂï°È§®',ja:'„Ç´„Éï„Çß',en:'Cafe'},{zh:'Âú∞‰∏ãÂÆ§',ja:'Âú∞‰∏ãÂÆ§',en:'Basement'},{zh:'Èõ≤Á´Ø‰∏ä',ja:'Èõ≤„ÅÆ‰∏ä',en:'Above clouds'},{zh:'Ê£ÆÊûóÊ∑±Ëôï',ja:'Ê∑±„ÅÑÊ£Æ',en:'Deep forest'},{zh:'Ê≤ôÊº†',ja:'Á†ÇÊº†',en:'Desert'},
                {zh:'ÁÅ´ÊòüÂü∫Âú∞',ja:'ÁÅ´ÊòüÂü∫Âú∞',en:'Mars base'},{zh:'ÂÇ≥Áµ±ÂíåÂÆ§',ja:'ÂíåÂÆ§',en:'Tatami room'},{zh:'Êë©Â§©Â§ßÊ®ì',ja:'Êë©Â§©Ê•º',en:'Skyscraper'},{zh:'Êµ∑ÈÇä',ja:'Êµ∑Ëæ∫',en:'Seaside'},{zh:'Ëä±Êµ∑',ja:'Ëä±Áïë',en:'Flower field'},{zh:'ÁµêÊô∂Ê¥ûÁ™ü',ja:'„ÇØ„É™„Çπ„Çø„É´„ÅÆÊ¥ûÁ™ü',en:'Crystal cave'},
                {zh:'ÂêëÊó•ËëµÁî∞',ja:'„Å≤„Åæ„Çè„ÇäÁïë',en:'Sunflower field'},{zh:'Ë≥ΩÂçöÂØ¶È©óÂÆ§',ja:'„Çµ„Ç§„Éê„Éº„É©„Éú',en:'Cyber lab'},{zh:'Âè§Â†°',ja:'Âè§Âüé',en:'Ancient castle'},{zh:'Êú™‰æÜÂ∑•Âª†',ja:'Êú™Êù•„ÅÆÂ∑•Â†¥',en:'Future factory'},{zh:'Â±ãÈ†Ç',ja:'Â±ã‰∏ä',en:'Rooftop'},{zh:'Ê∞¥ÊóèÈ§®',ja:'Ê∞¥ÊóèÈ§®',en:'Aquarium'}
            ],
            light: [
                {zh:'ÈªÉÈáëÊôÇÂàª',ja:'„Ç¥„Éº„É´„Éá„É≥„Ç¢„ÉØ„Éº',en:'Golden hour'},{zh:'ÈõªÂΩ±ÂÖâ',ja:'Êò†ÁîªÁöÑ„É©„Ç§„ÉÜ„Ç£„É≥„Ç∞',en:'Cinematic'},{zh:'È´îÁ©çÂÖâ',ja:'„Éú„É™„É•„É°„Éà„É™„ÉÉ„ÇØ„É©„Ç§„Éà',en:'Volumetric'},{zh:'ÈúìËôπÊ∞õÂúç',ja:'„Éç„Ç™„É≥„ÅÆËºù„Åç',en:'Neon glow'},{zh:'‰∏ÅÈÅîÁàæÊïàÊáâ',ja:'„ÉÅ„É≥„ÉÄ„É´ÁèæË±°',en:'Tyndall'},{zh:'ËÉåÂÖâ',ja:'„Éê„ÉÉ„ÇØ„É©„Ç§„Éà',en:'Backlighting'},
                {zh:'ÊüîÂíåÂÖâ',ja:'„ÇΩ„Éï„Éà„É©„Ç§„Éà',en:'Soft lighting'},{zh:'ÈõôËâ≤Ë™ø',ja:'„Éá„É•„Ç¢„É´„Éà„Éº„É≥',en:'Dual tone'},{zh:'ÊúàÂÖâ',ja:'ÊúàÂÖâ',en:'Moonlight'},{zh:'Á•ûËÅñÂÖâËäí',ja:'Á•û„ÄÖ„Åó„ÅÑÂÖâ',en:'Divine rays'},{zh:'Âº∑ÁÉàÈô∞ÂΩ±',ja:'Âº∑„ÅÑÈô∞ÂΩ±',en:'Hard shadow'},{zh:'ËàûÂè∞ÂÖâ',ja:'„Çπ„Éù„ÉÉ„Éà„É©„Ç§„Éà',en:'Spotlight'},
                {zh:'ÈñÉÁàçÂÖâ',ja:'„Åç„Çâ„ÇÅ„Åç',en:'Shimmering'},{zh:'ÊüîÂÖâÁÆ±',ja:'„ÇΩ„Éï„Éà„Éú„ÉÉ„ÇØ„Çπ',en:'Softbox'},{zh:'Ëá™ÁÑ∂ÂÖâ',ja:'Ëá™ÁÑ∂ÂÖâ',en:'Natural light'},{zh:'ÁÅ´ÂÖâ',ja:'ÁÇé„ÅÆÂÖâ',en:'Firelight'},{zh:'ÂÜ∑Ëâ≤Ë™ø',ja:'ÂØíËâ≤Á≥ª',en:'Cool tone'},{zh:'ÊöñËâ≤Ë™ø',ja:'ÊöñËâ≤Á≥ª',en:'Warm tone'},
                {zh:'ÂΩ©ËôπÂÖâ',ja:'ËôπËâ≤„ÅÆÂÖâ',en:'Iridescent'},{zh:'Èõ∑Â∞Ñ',ja:'„É¨„Éº„Ç∂„Éº',en:'Laser beams'},{zh:'Áá≠ÂÖâ',ja:'„Ç≠„É£„É≥„Éâ„É´„É©„Ç§„Éà',en:'Candlelight'},{zh:'È†ªÈñÉ',ja:'„Çπ„Éà„É≠„Éú',en:'Strobe'},{zh:'ËóçËâ≤ÊôÇÂàª',ja:'„Éñ„É´„Éº„Ç¢„ÉØ„Éº',en:'Blue hour'},{zh:'ÈªéÊòé',ja:'Â§úÊòé„Åë',en:'Dawn'},
                {zh:'ÂΩ±Ê£öÂÖâ',ja:'„Çπ„Çø„Ç∏„Ç™ÁÖßÊòé',en:'Studio lighting'},{zh:'ÈÇäÁ∑£ÂÖâ',ja:'„É™„É†„É©„Ç§„Éà',en:'Rim light'},{zh:'Â§öËâ≤ÂÖâ',ja:'„Éû„É´„ÉÅ„Ç´„É©„Éº',en:'Multi-color'},{zh:'Áí∞Â¢ÉÂÖâ',ja:'„Ç¢„É≥„Éì„Ç®„É≥„Éà„É©„Ç§„Éà',en:'Ambient light'},{zh:'ÈñÉÈõª',ja:'Á®≤Â¶ª',en:'Lightning flash'},{zh:'Ê•µÂÖâ',ja:'„Ç™„Éº„É≠„É©',en:'Aurora'}
            ],
            secret: [
                {zh:'ÊøïÈÄè',ja:'Êø°„ÇåÈÄè„Åë',en:'wet'},{zh:'ÂçäÈÄèÊòé',ja:'„Ç∑„Éº„Çπ„É´„Éº',en:'sheer'},{zh:'Êµ∏Êøï',ja:'„Å≥„Åó„ÇáÊø°„Çå',en:'soaked'},{zh:'ÈÄèÊòéË≥™ÊÑü',ja:'ÈÄèÊòéÊÑü',en:'transparent'},{zh:'Ê≤πÂÖâ',ja:'„Ç™„Ç§„É´',en:'oil'},{zh:'Ê±óÊ∞¥',ja:'Ê±ó',en:'sweat'},
                {zh:'ËïæÁµ≤ÈÄ£È´îË°£',ja:'„É¨„Éº„Çπ„Éú„Éá„Ç£„Çπ„Éº„ÉÑ',en:'lace bodysuit'},{zh:'ÂæÆÊØîÂü∫Â∞º',ja:'„Éû„Ç§„ÇØ„É≠„Éì„Ç≠„Éã',en:'micro bikini'},{zh:'ÊøïË•ØË°´',ja:'Êø°„Çå„Ç∑„É£„ÉÑ',en:'wet shirt'},{zh:'ËÖøÂºµÈñã',ja:'ÈñãËÑö',en:'thighs spread'},{zh:'ËÉåÈÉ®ÂºìËµ∑',ja:'ËÉå‰∏≠Âèç„Çä',en:'back arching'},{zh:'ÈáçÂëºÂê∏',ja:'Ëçí„ÅÑÊÅØ',en:'heavy breathing'},
                {zh:'Âí¨Âîá',ja:'Âîá„ÇíÂôõ„ÇÄ',en:'biting lip'},{zh:'ËáâÁ¥Ö',ja:'Ëµ§Èù¢',en:'flushed face'},{zh:'‰ΩéËßíÂ∫¶',ja:'„É≠„Éº„Ç¢„É≥„Ç∞„É´',en:'low angle'},{zh:'Âáå‰∫ÇÈ´ÆÂûã',ja:'‰π±„Çå„ÅüÈ´™',en:'messy hair'},{zh:'ÁúºÁ•ûËø∑Èõ¢',ja:'„ÅÜ„Å£„Å®„Çä„Åó„ÅüÁõÆ',en:'dreamy eyes'},{zh:'È†òÂè£Êãâ‰Ωé',ja:'Ë•ü„ÇíÂºï„Åè',en:'pulled collar'},
                {zh:'ÂêäÂ∏∂Ë•™',ja:'„Ç¨„Éº„Çø„Éº„Éô„É´„Éà',en:'garter belts'},{zh:'Á∑äË∫´Ë°£',ja:'„Éî„ÉÅ„Éî„ÉÅ',en:'skin tight'},{zh:'Ë™òÊÉëÂßøÂã¢',ja:'Ë™òÊÉë„Éù„Éº„Ç∫',en:'seductive pose'},{zh:'ÊâãÊîæÂú®ËÖøÈñì',ja:'ËÇ°Èñì„Å´Êâã',en:'hand between legs'},{zh:'Ê±óÊµÅÊµπËÉå',ja:'Ê±ó„Å†„Åè',en:'sweaty skin'},{zh:'ÂçäÈú≤',ja:'„ÉÅ„É©Ë¶ã„Åõ',en:'partially exposed'},
                {zh:'ËïæÁµ≤Á¥∞ÁØÄ',ja:'„É¨„Éº„Çπ„ÅÆ„Éá„Ç£„ÉÜ„Éº„É´',en:'lace details'},{zh:'Áµ≤Ë•™',ja:'„Çπ„Éà„ÉÉ„Ç≠„É≥„Ç∞',en:'stockings'},{zh:'Â§ßËÖøË•™',ja:'„Éã„Éº„ÇΩ',en:'thighhighs'},{zh:'Ë∫´È´îÊõ≤Á∑ö',ja:'„Éú„Éá„Ç£„É©„Ç§„É≥',en:'body curves'},{zh:'ÊåëÈÄóÁúºÁ•û',ja:'ÊåëÁô∫ÁöÑ„Å™ÁõÆ',en:'teasing look'},{zh:'ÁßÅÂØÜÊ∞õÂúç',ja:'Ë¶™ÂØÜ„Å™Èõ∞Âõ≤Ê∞ó',en:'intimate atmosphere'}
            ]
        };

        let state = { currentTab: 'character', mode: 'llm', lang: 'en' };
        const apiKey = "";

        function setLang(lang) {
            state.lang = lang;
            document.querySelectorAll('.lang-btn').forEach(b => {
                const isActive = (lang === 'zh' && b.innerText === 'ÁπÅ‰∏≠') || 
                               (lang === 'en' && b.innerText === 'EN') || 
                               (lang === 'ja' && b.innerText === 'JPN');
                b.classList.toggle('active', isActive);
            });
            updateUIText();
            renderTags();
            updatePreview();
        }

        function updateUIText() {
            const t = uiText[state.lang];
            // Safe update for elements that exist
            if(document.getElementById('ui-title')) document.getElementById('ui-title').innerText = t.title;
            if(document.getElementById('ui-subtitle')) document.getElementById('ui-subtitle').innerText = t.subtitle;
            if(document.getElementById('aiInput')) document.getElementById('aiInput').placeholder = t.placeholder;
            if(document.getElementById('aiBtnText')) document.getElementById('aiBtnText').innerText = t.btnAi;
            if(document.getElementById('btn-update')) document.getElementById('btn-update').innerText = t.btnUpdate;
            if(document.getElementById('btn-copy')) document.getElementById('btn-copy').innerText = t.btnCopy;
            
            // Tabs
            const tabKeys = ['character','outfit','shot','style','env','light','secret'];
            tabKeys.forEach(k => {
                const tabEl = document.getElementById(`tab-${k}`);
                if(tabEl) {
                    if(k === 'character') tabEl.innerText = t.tabs.char;
                    else tabEl.innerText = t.tabs[k];
                }
            });

            // Matrix Labels
            if(document.getElementById('lbl-character')) document.getElementById('lbl-character').innerText = t.matrix.char;
            if(document.getElementById('lbl-outfit')) document.getElementById('lbl-outfit').innerText = t.matrix.outfit;
            if(document.getElementById('lbl-shot')) document.getElementById('lbl-shot').innerText = t.matrix.shot;
            if(document.getElementById('lbl-style')) document.getElementById('lbl-style').innerText = t.matrix.style;
            if(document.getElementById('lbl-env')) document.getElementById('lbl-env').innerText = t.matrix.env;
            if(document.getElementById('lbl-secret')) document.getElementById('lbl-secret').innerText = t.matrix.secret;

            // Prompt waiting text
            const promptArea = document.getElementById('finalPrompt');
            if(promptArea.innerText.includes('Wait') || promptArea.innerText.includes('Á≠âÂæÖ') || promptArea.innerText.includes('ÂæÖÊ©ü')) {
                promptArea.innerText = t.waiting;
            }
        }

        function setMode(m) {
            state.mode = m;
            document.getElementById('mode-mj').className = m === 'mj' ? 'mode-active px-3 py-1 rounded-[3px] text-[9px] font-bold transition tracking-wider' : 'px-3 py-1 rounded-[3px] text-[9px] font-bold transition text-slate-500 tracking-wider';
            document.getElementById('mode-llm').className = m === 'llm' ? 'mode-active px-3 py-1 rounded-[3px] text-[9px] font-bold transition tracking-wider' : 'px-3 py-1 rounded-[3px] text-[9px] font-bold transition text-slate-500 tracking-wider';
            updatePreview();
        }

        async function askAI() {
            const input = document.getElementById('aiInput').value;
            if (!input) return;
            const btnText = document.getElementById('aiBtnText');
            const loading = document.getElementById('aiLoading');
            btnText.classList.add('hidden'); loading.classList.remove('hidden');
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `Expand this concept into exactly 15 visual keywords: "${input}". Output ONLY keywords separated by commas. Focus on visual description.` }] }],
                        systemInstruction: { parts: [{ text: "You are an AI prompt expert. Output only comma-separated English tags." }] }
                    })
                });
                const result = await response.json();
                const aiTags = result.candidates?.[0]?.content?.parts?.[0]?.text?.trim() || "";
                document.getElementById('m-character').value = aiTags;
                updatePreview();
                showStatus(uiText[state.lang].toastAiSuccess, "blue");
            } catch (err) { showStatus(uiText[state.lang].toastAiFail, "red"); }
            finally { btnText.classList.remove('hidden'); loading.classList.add('hidden'); }
        }

        function updatePreview() {
            const t = uiText[state.lang];
            const ar = document.getElementById('arSelect').value;
            const preview = document.getElementById('finalPrompt');
            const ids = ['m-character','m-outfit','m-shot','m-style','m-env','m-secret'];
            
            // Calculate active nodes for UI display
            const activeNodes = ids.filter(id => document.getElementById(id).value.trim() !== "").length;
            document.getElementById('node-count').innerText = activeNodes;

            const content = ids.map(id => document.getElementById(id).value).filter(v => v.trim() !== "").join(', ');
            
            if (!content) { preview.innerText = t.waiting; return; }
            
            if (state.mode === 'mj') {
                preview.innerText = `/imagine prompt: ${content} ${ar} --v 6.1 --stylize 300`;
            } else {
                const ratio = ar.replace('--ar ', '').replace(':', ' to ');
                preview.innerText = `[Visual Prompt]: A high-quality image featuring ${content}. Detailed, 8k resolution, photorealistic, aspect ratio ${ratio}.`;
            }
        }

        function switchTab(tabId, btn) {
            state.currentTab = tabId;
            document.querySelectorAll('.btn-tab').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            renderTags();
        }

        function renderTags() {
            const container = document.getElementById('tagsContainer');
            container.innerHTML = '';
            const tags = tagLibrary[state.currentTab] || [];
            tags.forEach(tag => {
                const button = document.createElement('button');
                const isSecret = state.currentTab === 'secret';
                // Professional styling, conditional red border for NSFW
                button.className = `tag p-1.5 md:p-2 rounded transition group min-h-[46px] active:scale-95 ${isSecret ? 'tag-nsfw' : ''}`;
                
                let mainText = tag[state.lang] || tag.en;
                let subText = tag.en;
                if(state.lang === 'en') {
                    subText = tag.ja || tag.zh; 
                }

                button.innerHTML = `
                    <div class="text-[9px] md:text-[10px] font-bold ${isSecret ? 'text-rose-100' : 'text-slate-200'} group-hover:text-blue-400 leading-tight truncate px-1 uppercase tracking-wide">${mainText}</div>
                    <div class="text-[8px] text-slate-500 font-mono leading-tight truncate px-1 mt-0.5">${subText}</div>
                `;
                button.onclick = () => {
                    const area = document.getElementById(`m-${state.currentTab}`);
                    if (!area.value.includes(tag.en)) {
                        area.value += (area.value ? ', ' : '') + tag.en;
                        updatePreview();
                    }
                };
                container.appendChild(button);
            });
        }

        function copyPrompt() {
            const text = document.getElementById('finalPrompt').innerText;
            // Basic check to not copy placeholder text
            const t = uiText[state.lang];
            if (text === t.waiting) return;
            
            const temp = document.createElement('textarea');
            temp.value = text; document.body.appendChild(temp);
            temp.select(); document.execCommand('copy');
            document.body.removeChild(temp);
            showStatus(uiText[state.lang].toastCopy, "emerald");
        }

        function showStatus(msg, type) {
            const toast = document.createElement('div');
            const bg = { emerald: 'bg-emerald-600', red: 'bg-rose-600', blue: 'bg-blue-600' }[type] || 'bg-blue-600';
            toast.className = `fixed top-6 left-1/2 -translate-x-1/2 ${bg} text-white px-6 py-2 rounded shadow-2xl text-[10px] font-bold z-50 uppercase tracking-widest animate-pulse`;
            toast.innerText = msg; document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2000);
        }

        function resetAll() { 
            if(confirm(uiText[state.lang].resetConfirm)) {
                ['m-character','m-outfit','m-shot','m-style','m-env','m-secret'].forEach(id => document.getElementById(id).value = '');
                document.getElementById('aiInput').value = '';
                updatePreview();
            }
        }
        
        window.onload = function() {
            updateUIText();
            renderTags();
        }
    </script>
</body>
</html>
